<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
		#l-map{height:300px;width:100%;}
		#r-result {width:100%;}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZNzgKvvZvOmvvBSnER2yEi7W1CHs9WQm"></script>
	<title>公交/地铁线路查询</title>
</head>
<body>
    <p>
        城市名称:<input type="text" value="南京" id="cityName"/>
    </p>
    <p>
        公交名称:<input type="text" value="11路" id="busId"/>
        <input type="button" value="查询" onclick="busSearch();"/>
        (多条线路查询用英文逗号分割)
    </p>
        <div>
        <table id="data">
            <thead>
                <tr style="text-align:center;width:100%;">
                    <td colspan="7" style="front-size:larger;">
                        线路信息
                    </td>
                </tr>
                <tr style="text-align:left;width:100%">
                    <td colspan="7" style="font-size:larger;">
                        名称，开始时间，结束时间，公交公司，站台数，轨迹点
                    </td>
                </tr>
            </thead>
          <tbody id="tabledata" style="height:100%;width:100%;padding:0;"></tbody>
        </table>
        </div>
</body>
</html>
<script type="text/javascript">
  	var busline
    var dataHtml = ''
	busline = new BMap.BusLineSearch(document.getElementById("cityName").value, {
	    onGetBusListComplete: function(result){
	        if (result) {
              var fstLine = result.getBusListItem(0);
              busline.getBusLine(fstLine);
            }
        },
	    onGetBusLineComplete: function(busline){
	        if (busline) {
	            //线路信息
                  var startTime = busline.startTime;
                  var endTime = busline.endTime;
                  var company = busline.company;
                  var numBusStations = busline.getNumBusStations();
                  var name = busline.name;
                  var data = name + ';' + startTime + ';' + endTime + ';' + company + ';' + numBusStations;
                  dataHtml += data;
                  //公交轨迹点信息
                  var points = busline.getPath();
                  var path = "";
                  var linedata = "";
                  for (var i = 0; i<points.length; i++){
                    path += points[i].lng;
                    path += ",";
                    path += points[i].lat;
                    path += ";";
              }
              dataHtml = dataHtml + ';' +  path + "<br>";
              document.getElementById("tabledata").innerHTML = dataHtml;
            }
        }
    });
    function busSearch(){
        tabledataHtml = ''
        tabledataPath = ''
        var busName = document.getElementById("busId").value;
        if(busName != ''){
            var list = busName.split(/[,,]/); //正则表达式
            if (list.length>0){
                for (var kk = 0; kk<list.length; kk++){
                    busline.getBusList(list[kk]);
                }
            }
        }
        else{
            alert('请输入查询公交名称')
        }
    }
</script>
